theme_basic() +
theme(legend.position = c(0.8, 0.1))
ggplot(he %>% filter(var %in% c('OutOfPocketHlthExpend', 'GovHlthExpendOfTotalExpend')),
aes(x = Year, y = rate,
colour = var,
group = var)) +
geom_line() +
facet_wrap(~Country) +
theme_basic() +
theme(legend.position = c(0.8, 0.1))
ggplot(he %>% filter(var %in% c('OutOfPocketHlthExpend', 'GovHlthExpendOfTotalExpend')),
aes(x = Year, y = rate,
colour = var,
group = var)) +
geom_line() +
facet_wrap(~Country, scales = 'free_y') +
theme_basic() +
theme(legend.position = c(0.8, 0.1))
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_healthEcon2_freescales.pdf",
width = 7, height = 4.5,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(he %>% filter(var %in% c('OutOfPocketHlthExpend', 'GovHlthExpendOfTotalExpend')),
aes(x = Year, y = rate,
colour = var,
group = var)) +
geom_line() +
facet_wrap(~Country) +
theme_basic() +
theme(legend.position = c(0.8, 0.1))
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_healthEcon2.pdf",
width = 7, height = 4.5,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(he %>% filter(var %in% c('OutOfPocketHlthExpend', 'GovHlthExpendOfTotalExpend')),
aes(x = Year, y = rate,
colour = var,
group = var)) +
geom_line() +
facet_wrap(~Country, scales = 'free_y') +
theme_basic() +
theme(legend.position = c(0.8, 0.1),
panel.margin = unit(0.5, 'lines'))
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_healthEcon2_freescales.pdf",
width = 7, height = 4.5,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(he %>% filter(var %in% c('OutOfPocketHlthExpend', 'GovHlthExpendOfTotalExpend')),
aes(x = Year, y = rate,
colour = var,
group = var)) +
geom_line() +
facet_wrap(~Country) +
theme_basic() +
theme(legend.position = c(0.8, 0.1),
panel.margin = unit(0.5, 'lines'))
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_healthEcon2.pdf",
width = 7, height = 4.5,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
healthEcon = read.csv('~/Documents/USAID/West Africa Regional 2016/datain/HealthEconomics.csv')
he = healthEcon %>%
gather(var, rate, -Year, -YearCode, -Country)
# Health econ1: GDP + health exp + ext exp. -------------------------------
ggplot(healthEcon, aes(x = GDPGrowthRate, y = GovHlthExpendOfTotalExpend,
# colour = ExternalHlthExpendOfTotalHlthExpend,
alpha = Year, group = Country)) +
geom_path() +
facet_wrap(~Country, scales = 'free') +
theme_xygrid()
order = healthEcon %>%
filter(Year == 2013) %>%
ungroup() %>%
arrange(desc(GovHlthExpendOfTotalExpend))
he$Country = factor(he$Country,
levels = order$Country)
ggplot(he %>% filter(var %in% c('GDPGrowthRate', 'GovHlthExpendOfTotalExpend', 'ExternalHlthExpendOfTotalHlthExpend')), aes(x = Year, y = rate,
colour = var,
group = var)) +
geom_line() +
facet_wrap(~Country, scales = 'free_y') +
theme_basic() +
theme(legend.position = c(0.8, 0.1),
panel.margin = unit(0.5, 'lines'))
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_healthEcon1_freescales.pdf",
width = 7, height = 4.5,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(he %>% filter(var %in% c('GDPGrowthRate', 'GovHlthExpendOfTotalExpend', 'ExternalHlthExpendOfTotalHlthExpend')), aes(x = Year, y = rate,
colour = var,
group = var)) +
geom_line() +
facet_wrap(~Country) +
theme_basic() +
theme(legend.position = c(0.8, 0.1),
panel.margin = unit(0.5, 'lines'))
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_healthEcon1.pdf",
width = 7, height = 4.5,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
healthEcon = healthEcon %>%
group_by(Country)
arrange(Year)
# ggplot(healthEcon, aes(x = Year, y = OutOfPocketHlthExpend,
#                        alpha = Year, group = Country
#                        # colour = ExternalHlthExpendOfTotalHlthExpend,
# )) +
#   geom_path(size = 1) +
#   scale_colour_gradientn(colours = brewer.pa) +
#   # geom_text(aes(label = Year)) +
#   facet_wrap(~Country, scales = 'free_y') +
#   theme_xygridlight()
ggplot(he %>% filter(var %in% c('OutOfPocketHlthExpend', 'GovHlthExpendOfTotalExpend')),
aes(x = Year, y = rate,
colour = var,
group = var)) +
geom_line() +
facet_wrap(~Country, scales = 'free_y') +
theme_basic() +
theme(legend.position = c(0.8, 0.1),
panel.margin = unit(0.5, 'lines'))
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_healthEcon2_freescales.pdf",
width = 7, height = 4.5,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(he %>% filter(var %in% c('OutOfPocketHlthExpend', 'GovHlthExpendOfTotalExpend')),
aes(x = Year, y = rate,
colour = var,
group = var)) +
geom_line() +
facet_wrap(~Country) +
theme_basic() +
theme(legend.position = c(0.8, 0.1),
panel.margin = unit(0.5, 'lines'))
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_healthEcon2.pdf",
width = 7, height = 4.5,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
# Not strong relationship -------------------------------------------------
ggplot(healthEcon %>% filter(Year == 2013), aes(x = OutOfPocketHlthExpend, y = GovHlthExpendOfTotalExpend)) +
geom_point()
ggplot(healthEcon %>% filter(Year == 2013), aes(x = OutOfPocketHlthExpend, y = GovHlthExpendOfTotalExpend)) +
geom_point()
library(dplyr)
library(tidyr)
library(ggplot2)
library(shiny)
library(shinydashboard)
library(stringr)
library(llamar)
library(choroplethr)
library(choroplethrMaps)
library(RColorBrewer)
accentColor = '#b2182b'
ltColor  = '#e0a3aa'
# import data -------------------------------------------------------------
tfr = read.csv('data/WFAR_tfr.csv')
choroData = read.csv('data/choroData.csv')
countries = levels(unique(tfr$country))
minChg = round(min(tfr$refRate, na.rm = TRUE)*100, 0)
maxChg = round(max(tfr$refRate, na.rm = TRUE)*100, 0)
tfr = read.csv('data/WFAR_tfr.csv')
setwd("~/GitHub/West Africa 2016/WestAfrica")
# Dashboard to explore total fertility rates in West Africa
# Laura Hughes, lhughes@usaid.gov, 6 April 2016
# Set up the app ----------------------------------------------------------
library(dplyr)
library(tidyr)
library(ggplot2)
library(shiny)
library(shinydashboard)
library(stringr)
library(llamar)
library(choroplethr)
library(choroplethrMaps)
library(RColorBrewer)
accentColor = '#b2182b'
ltColor  = '#e0a3aa'
# import data -------------------------------------------------------------
tfr = read.csv('data/WFAR_tfr.csv')
choroData = read.csv('data/choroData.csv')
countries = levels(unique(tfr$country))
minChg = round(min(tfr$refRate, na.rm = TRUE)*100, 0)
maxChg = round(max(tfr$refRate, na.rm = TRUE)*100, 0)
filteredTFR = tfr
recentTFR = filteredTFR %>% filter(year == '2010-2015')
order = filteredTFR %>%
ungroup() %>%
filter(year =='2010-2015') %>%
arrange(desc(tfr))
filteredTFR$country = factor(filteredTFR$country,
levels  = order$country)
annot <- data.frame(year = '1950-1955',
tfr = recentTFR$tfrWAfr,
lab = 'West Africa (excluding Cameroon)',
country = factor(levels(filteredTFR$country)[1],levels = filteredTFR$country))
p = ggplot(filteredTFR, aes(x = year, y = tfr, group = country)) +
geom_line(colour = grey50K,
aes(y = tfrWAfr)) +
geom_text(aes(label = lab), data = annot,
colour = grey50K,
nudge_y = -1,
size = 3,
hjust = 0) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
size = 2.5,
data = recentTFR)+
geom_point(aes(y = tfrWAfr),
data = recentTFR,
size = 2.5,
colour = grey50K) +
# geom_point(aes(y = prb),
# data = recentTFR,
# colour = 'dodgerblue')+
geom_text(aes(label = round(tfr,1)),
colour = accentColor,
nudge_y = -0.7,
hjust = 1,
data = recentTFR) +
# geom_text(aes(label = round(prb,1)),
#           colour = 'dodgerblue',
#           nudge_y = -1,
#           hjust = 1,
#           data = recentTFR) +
facet_wrap(~country) +
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(limits = c(0,8),
breaks = seq(0, 8, by = 2)) +
xlab('') + ylab('')+
ggtitle('Niger and Mali have high Total Fertility Rates relative to the rest of the region') +
theme(axis.text.x = element_text(size = 9),
legend.position = 'bottom',
legend.direction = 'horizontal')
p
setwd("~/GitHub/West Africa 2016/WestAfrica")
# Dashboard to explore total fertility rates in West Africa
# Laura Hughes, lhughes@usaid.gov, 6 April 2016
# Set up the app ----------------------------------------------------------
library(dplyr)
library(tidyr)
library(ggplot2)
library(shiny)
library(shinydashboard)
library(stringr)
library(llamar)
library(choroplethr)
library(choroplethrMaps)
library(RColorBrewer)
accentColor = '#b2182b'
ltColor  = '#e0a3aa'
# import data -------------------------------------------------------------
tfr = read.csv('data/WFAR_tfr.csv')
choroData = read.csv('data/choroData.csv')
countries = levels(unique(tfr$country))
minChg = round(min(tfr$refRate, na.rm = TRUE)*100, 0)
maxChg = round(max(tfr$refRate, na.rm = TRUE)*100, 0)
filteredTFR = tfr
recentTFR = filteredTFR %>% filter(year == '2010-2015')
order = filteredTFR %>%
ungroup() %>%
filter(year =='2010-2015') %>%
arrange(desc(tfr))
filteredTFR$country = factor(filteredTFR$country,
levels  = order$country)
annot <- data.frame(year = '1950-1955',
tfr = recentTFR$tfrWAfr,
lab = 'West Africa (excluding Cameroon)',
country = factor(levels(filteredTFR$country)[1],levels = filteredTFR$country))
p = ggplot(filteredTFR, aes(x = year, y = tfr, group = country)) +
geom_line(colour = grey50K,
aes(y = tfrWAfr)) +
geom_text(aes(label = lab), data = annot,
colour = grey50K,
nudge_y = -1,
size = 3,
hjust = 0) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
size = 2.5,
data = recentTFR)+
geom_point(aes(y = tfrWAfr),
data = recentTFR,
size = 2.5,
colour = grey50K) +
# geom_point(aes(y = prb),
# data = recentTFR,
# colour = 'dodgerblue')+
geom_text(aes(label = round(tfr,1)),
colour = accentColor,
nudge_y = -0.7,
hjust = 1,
data = recentTFR) +
# geom_text(aes(label = round(prb,1)),
#           colour = 'dodgerblue',
#           nudge_y = -1,
#           hjust = 1,
#           data = recentTFR) +
facet_wrap(~country) +
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(limits = c(0,8),
breaks = seq(0, 8, by = 2)) +
xlab('') + ylab('')+
ggtitle('Niger and Mali have high Total Fertility Rates relative to the rest of the region') +
theme(axis.text.x = element_text(size = 9),
legend.position = 'bottom',
legend.direction = 'horizontal')
p
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_time.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
library(llamar)
loadPkgs()
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_time.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
yLim = c(-0.35, 0.10)
recentTFR = filteredTFR %>% filter(year == '2010-2015')
ggplot(filteredTFR, aes(x = year, y = rate,
label = percent(rate),
group = country)) +
geom_hline(yintercept = 0, colour = grey90K, size = 0.3) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
data = recentTFR)+
geom_label(colour = accentColor,
data = recentTFR, nudge_y = -0.08)+
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(labels = scales::percent,
breaks = seq(yLim[1], yLim[2], by = 0.15),
limits = yLim) +
ggtitle(paste0('rate of change in TFR')) +
theme(axis.text.x = element_text(size = 14)) +
facet_wrap(~country) +
ylab('') + xlab('')
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_rate.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(filteredTFR, aes(x = year, y = rate,
label = percent(rate),
group = country)) +
geom_hline(yintercept = 0, colour = grey90K, size = 0.3) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
data = recentTFR)+
geom_label(colour = accentColor,
data = recentTFR, nudge_y = -0.1, nudge_x = -0.25)+
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(labels = scales::percent,
breaks = seq(yLim[1], yLim[2], by = 0.15),
limits = yLim) +
ggtitle(paste0('rate of change in TFR')) +
theme(axis.text.x = element_text(size = 14)) +
facet_wrap(~country) +
ylab('') + xlab('')
ggplot(filteredTFR, aes(x = year, y = rate,
label = percent(rate),
group = country)) +
geom_hline(yintercept = 0, colour = grey90K, size = 0.3) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
data = recentTFR)+
geom_label(colour = accentColor,
data = recentTFR, nudge_y = -0.1, nudge_x = -0.45)+
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(labels = scales::percent,
breaks = seq(yLim[1], yLim[2], by = 0.15),
limits = yLim) +
ggtitle(paste0('rate of change in TFR')) +
theme(axis.text.x = element_text(size = 14)) +
facet_wrap(~country) +
ylab('') + xlab('')
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_rate.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(filteredTFR, aes(x = year, y = rate,
label = percent(rate),
group = country)) +
geom_hline(yintercept = 0, colour = grey90K, size = 0.3) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
data = recentTFR)+
geom_label(colour = accentColor,
data = recentTFR, nudge_y = -0.1, nudge_x = -0.75)+
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(labels = scales::percent,
breaks = seq(yLim[1], yLim[2], by = 0.15),
limits = yLim) +
ggtitle(paste0('rate of change in TFR')) +
theme(axis.text.x = element_text(size = 14)) +
facet_wrap(~country) +
ylab('') + xlab('')
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_rate.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(filteredTFR, aes(x = year, y = rate,
label = percent(rate),
group = country)) +
geom_hline(yintercept = 0, colour = grey90K, size = 0.3) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
data = recentTFR)+
geom_label(colour = accentColor,
data = recentTFR, nudge_y = -0.1, nudge_x = -1.5)+
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(labels = scales::percent,
breaks = seq(yLim[1], yLim[2], by = 0.15),
limits = yLim) +
ggtitle(paste0('rate of change in TFR')) +
theme(axis.text.x = element_text(size = 14)) +
facet_wrap(~country) +
ylab('') + xlab('')
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_rate.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
