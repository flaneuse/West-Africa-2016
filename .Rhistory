theme_basic() +
theme(legend.position = c(0.8, 0.1),
panel.margin = unit(0.5, 'lines'))
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_healthEcon2_freescales.pdf",
width = 7, height = 4.5,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(he %>% filter(var %in% c('OutOfPocketHlthExpend', 'GovHlthExpendOfTotalExpend')),
aes(x = Year, y = rate,
colour = var,
group = var)) +
geom_line() +
facet_wrap(~Country) +
theme_basic() +
theme(legend.position = c(0.8, 0.1),
panel.margin = unit(0.5, 'lines'))
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_healthEcon2.pdf",
width = 7, height = 4.5,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
# Not strong relationship -------------------------------------------------
ggplot(healthEcon %>% filter(Year == 2013), aes(x = OutOfPocketHlthExpend, y = GovHlthExpendOfTotalExpend)) +
geom_point()
ggplot(healthEcon %>% filter(Year == 2013), aes(x = OutOfPocketHlthExpend, y = GovHlthExpendOfTotalExpend)) +
geom_point()
library(dplyr)
library(tidyr)
library(ggplot2)
library(shiny)
library(shinydashboard)
library(stringr)
library(llamar)
library(choroplethr)
library(choroplethrMaps)
library(RColorBrewer)
accentColor = '#b2182b'
ltColor  = '#e0a3aa'
# import data -------------------------------------------------------------
tfr = read.csv('data/WFAR_tfr.csv')
choroData = read.csv('data/choroData.csv')
countries = levels(unique(tfr$country))
minChg = round(min(tfr$refRate, na.rm = TRUE)*100, 0)
maxChg = round(max(tfr$refRate, na.rm = TRUE)*100, 0)
tfr = read.csv('data/WFAR_tfr.csv')
setwd("~/GitHub/West Africa 2016/WestAfrica")
# Dashboard to explore total fertility rates in West Africa
# Laura Hughes, lhughes@usaid.gov, 6 April 2016
# Set up the app ----------------------------------------------------------
library(dplyr)
library(tidyr)
library(ggplot2)
library(shiny)
library(shinydashboard)
library(stringr)
library(llamar)
library(choroplethr)
library(choroplethrMaps)
library(RColorBrewer)
accentColor = '#b2182b'
ltColor  = '#e0a3aa'
# import data -------------------------------------------------------------
tfr = read.csv('data/WFAR_tfr.csv')
choroData = read.csv('data/choroData.csv')
countries = levels(unique(tfr$country))
minChg = round(min(tfr$refRate, na.rm = TRUE)*100, 0)
maxChg = round(max(tfr$refRate, na.rm = TRUE)*100, 0)
filteredTFR = tfr
recentTFR = filteredTFR %>% filter(year == '2010-2015')
order = filteredTFR %>%
ungroup() %>%
filter(year =='2010-2015') %>%
arrange(desc(tfr))
filteredTFR$country = factor(filteredTFR$country,
levels  = order$country)
annot <- data.frame(year = '1950-1955',
tfr = recentTFR$tfrWAfr,
lab = 'West Africa (excluding Cameroon)',
country = factor(levels(filteredTFR$country)[1],levels = filteredTFR$country))
p = ggplot(filteredTFR, aes(x = year, y = tfr, group = country)) +
geom_line(colour = grey50K,
aes(y = tfrWAfr)) +
geom_text(aes(label = lab), data = annot,
colour = grey50K,
nudge_y = -1,
size = 3,
hjust = 0) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
size = 2.5,
data = recentTFR)+
geom_point(aes(y = tfrWAfr),
data = recentTFR,
size = 2.5,
colour = grey50K) +
# geom_point(aes(y = prb),
# data = recentTFR,
# colour = 'dodgerblue')+
geom_text(aes(label = round(tfr,1)),
colour = accentColor,
nudge_y = -0.7,
hjust = 1,
data = recentTFR) +
# geom_text(aes(label = round(prb,1)),
#           colour = 'dodgerblue',
#           nudge_y = -1,
#           hjust = 1,
#           data = recentTFR) +
facet_wrap(~country) +
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(limits = c(0,8),
breaks = seq(0, 8, by = 2)) +
xlab('') + ylab('')+
ggtitle('Niger and Mali have high Total Fertility Rates relative to the rest of the region') +
theme(axis.text.x = element_text(size = 9),
legend.position = 'bottom',
legend.direction = 'horizontal')
p
setwd("~/GitHub/West Africa 2016/WestAfrica")
# Dashboard to explore total fertility rates in West Africa
# Laura Hughes, lhughes@usaid.gov, 6 April 2016
# Set up the app ----------------------------------------------------------
library(dplyr)
library(tidyr)
library(ggplot2)
library(shiny)
library(shinydashboard)
library(stringr)
library(llamar)
library(choroplethr)
library(choroplethrMaps)
library(RColorBrewer)
accentColor = '#b2182b'
ltColor  = '#e0a3aa'
# import data -------------------------------------------------------------
tfr = read.csv('data/WFAR_tfr.csv')
choroData = read.csv('data/choroData.csv')
countries = levels(unique(tfr$country))
minChg = round(min(tfr$refRate, na.rm = TRUE)*100, 0)
maxChg = round(max(tfr$refRate, na.rm = TRUE)*100, 0)
filteredTFR = tfr
recentTFR = filteredTFR %>% filter(year == '2010-2015')
order = filteredTFR %>%
ungroup() %>%
filter(year =='2010-2015') %>%
arrange(desc(tfr))
filteredTFR$country = factor(filteredTFR$country,
levels  = order$country)
annot <- data.frame(year = '1950-1955',
tfr = recentTFR$tfrWAfr,
lab = 'West Africa (excluding Cameroon)',
country = factor(levels(filteredTFR$country)[1],levels = filteredTFR$country))
p = ggplot(filteredTFR, aes(x = year, y = tfr, group = country)) +
geom_line(colour = grey50K,
aes(y = tfrWAfr)) +
geom_text(aes(label = lab), data = annot,
colour = grey50K,
nudge_y = -1,
size = 3,
hjust = 0) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
size = 2.5,
data = recentTFR)+
geom_point(aes(y = tfrWAfr),
data = recentTFR,
size = 2.5,
colour = grey50K) +
# geom_point(aes(y = prb),
# data = recentTFR,
# colour = 'dodgerblue')+
geom_text(aes(label = round(tfr,1)),
colour = accentColor,
nudge_y = -0.7,
hjust = 1,
data = recentTFR) +
# geom_text(aes(label = round(prb,1)),
#           colour = 'dodgerblue',
#           nudge_y = -1,
#           hjust = 1,
#           data = recentTFR) +
facet_wrap(~country) +
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(limits = c(0,8),
breaks = seq(0, 8, by = 2)) +
xlab('') + ylab('')+
ggtitle('Niger and Mali have high Total Fertility Rates relative to the rest of the region') +
theme(axis.text.x = element_text(size = 9),
legend.position = 'bottom',
legend.direction = 'horizontal')
p
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_time.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
library(llamar)
loadPkgs()
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_time.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
yLim = c(-0.35, 0.10)
recentTFR = filteredTFR %>% filter(year == '2010-2015')
ggplot(filteredTFR, aes(x = year, y = rate,
label = percent(rate),
group = country)) +
geom_hline(yintercept = 0, colour = grey90K, size = 0.3) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
data = recentTFR)+
geom_label(colour = accentColor,
data = recentTFR, nudge_y = -0.08)+
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(labels = scales::percent,
breaks = seq(yLim[1], yLim[2], by = 0.15),
limits = yLim) +
ggtitle(paste0('rate of change in TFR')) +
theme(axis.text.x = element_text(size = 14)) +
facet_wrap(~country) +
ylab('') + xlab('')
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_rate.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(filteredTFR, aes(x = year, y = rate,
label = percent(rate),
group = country)) +
geom_hline(yintercept = 0, colour = grey90K, size = 0.3) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
data = recentTFR)+
geom_label(colour = accentColor,
data = recentTFR, nudge_y = -0.1, nudge_x = -0.25)+
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(labels = scales::percent,
breaks = seq(yLim[1], yLim[2], by = 0.15),
limits = yLim) +
ggtitle(paste0('rate of change in TFR')) +
theme(axis.text.x = element_text(size = 14)) +
facet_wrap(~country) +
ylab('') + xlab('')
ggplot(filteredTFR, aes(x = year, y = rate,
label = percent(rate),
group = country)) +
geom_hline(yintercept = 0, colour = grey90K, size = 0.3) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
data = recentTFR)+
geom_label(colour = accentColor,
data = recentTFR, nudge_y = -0.1, nudge_x = -0.45)+
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(labels = scales::percent,
breaks = seq(yLim[1], yLim[2], by = 0.15),
limits = yLim) +
ggtitle(paste0('rate of change in TFR')) +
theme(axis.text.x = element_text(size = 14)) +
facet_wrap(~country) +
ylab('') + xlab('')
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_rate.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(filteredTFR, aes(x = year, y = rate,
label = percent(rate),
group = country)) +
geom_hline(yintercept = 0, colour = grey90K, size = 0.3) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
data = recentTFR)+
geom_label(colour = accentColor,
data = recentTFR, nudge_y = -0.1, nudge_x = -0.75)+
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(labels = scales::percent,
breaks = seq(yLim[1], yLim[2], by = 0.15),
limits = yLim) +
ggtitle(paste0('rate of change in TFR')) +
theme(axis.text.x = element_text(size = 14)) +
facet_wrap(~country) +
ylab('') + xlab('')
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_rate.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
ggplot(filteredTFR, aes(x = year, y = rate,
label = percent(rate),
group = country)) +
geom_hline(yintercept = 0, colour = grey90K, size = 0.3) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
data = recentTFR)+
geom_label(colour = accentColor,
data = recentTFR, nudge_y = -0.1, nudge_x = -1.5)+
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygridlight() +
scale_y_continuous(labels = scales::percent,
breaks = seq(yLim[1], yLim[2], by = 0.15),
limits = yLim) +
ggtitle(paste0('rate of change in TFR')) +
theme(axis.text.x = element_text(size = 14)) +
facet_wrap(~country) +
ylab('') + xlab('')
ggsave("~/GitHub/West Africa 2016/plots/2016-04-11_WAFR_TFR_rate.pdf",
width = 10, height = 6,
bg = 'transparent',
paper = 'special',
units = 'in',
useDingbats=FALSE,
compress = FALSE,
dpi = 300)
library(llamar)
loadPkgs()
# Static things -----------------------------------------------------------
accentColor = '#b2182b'
refYr = '1980-1985'
# Load Data ---------------------------------------------------------------
tfr = read_excel('~/Documents/USAID/West Africa Regional 2016/datain/WPP_TFR.xlsx',
sheet = 1)
prb = read_excel('~/Documents/USAID/West Africa Regional 2016/datain/WAFR_PRB_TFR.xlsx') %>%
mutate(prb = as.numeric(Data)
# country = rem
# country = ifelse(country == 'Cape Verde', 'Cabo Verde', country)
) %>%
filter(TimeFrame == 2014) %>%
select(Location, prb)
# Wrangle -----------------------------------------------------------------
# Pull out the regional numbers
regionalTFR = tfr %>%
select(year,
tfrWAfr = `Western Africa`) %>%
mutate(laggedWAfr = lag(tfrWAfr),
rateWAfr = (tfrWAfr - laggedWAfr)/laggedWAfr)
# Tidy
tfr = tfr %>%
gather(country, tfr, -year) %>%
filter(!(country %in% c('Sub-Saharan Africa', 'AFRICA', 'Western Africa'))) %>%
group_by(country) %>%
mutate(lagged = lag(tfr),
rate = (tfr - lagged)/lagged
)
# Pull out the reference number
refTFR = tfr %>%
filter(year == refYr) %>%
select(country, refTFR = tfr)
tfr = full_join(tfr, regionalTFR) %>%
mutate(diffRate = rate-rateWAfr)
tfr = left_join(tfr, prb, by = c("country" = "Location"))
tfr = full_join(tfr, refTFR, by = 'country')
order = tfr %>%
ungroup() %>%
filter(year =='2010-2015') %>%
arrange(desc(tfr))
tfr$country = factor(tfr$country,
levels  = order$country)
# save --------------------------------------------------------------------
tfr = tfr %>%
select(-lagged,-laggedWAfr) %>%
mutate(refRate = (tfr - refTFR) / refTFR)
write.csv(tfr, '~/Documents/USAID/West Africa Regional 2016/dataout/WFAR_tfr.csv')
# TFR over time -----------------------------------------------------------
ggplot(tfr, aes(x = year, y = tfr, group = country)) +
geom_line(colour = grey50K,
aes(y = tfrWAfr)) +
geom_line(colour = accentColor) +
geom_point(colour = accentColor,
data = tfr %>% filter(year == '2010-2015'))+
geom_point(aes(y = prb),
data = tfr %>% filter(year == '2010-2015'),
colour = 'dodgerblue')+
geom_text(aes(label = round(tfr,1)),
colour = accentColor,
nudge_y = -1,
hjust = 1,
data = tfr %>% filter(year == '2010-2015')) +
geom_text(aes(label = round(prb,1)),
colour = 'dodgerblue',
nudge_y = -1,
hjust = 1,
data = tfr %>% filter(year == '2010-2015')) +
facet_wrap(~country) +
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygrid() +
scale_y_continuous(limits = c(0,8)) +
ggtitle('Niger and Mali have high Total Fertility Rates relative to the rest of the region') +
theme(axis.text.x = element_text(size = 10),
panel.margin = unit(1, 'lines'))
# TFR rate over time ------------------------------------------------------
ggplot(tfr, aes(x = year, y = rate, group = country)) +
# geom_line(colour = grey50K,
# aes(y = rateWAfr)) +
geom_line(colour = accentColor) +
# geom_ribbon(aes(ymin = rateWAfr, ymax = rate),
#             fill = 'blue',
#             alpha = 0.15) +
geom_point(colour = accentColor,
data = tfr %>% filter(year == '2010-2015'))+
facet_wrap(~country) +
scale_x_discrete(breaks = c('1950-1955','1960-1965', '1970-1975',
'1980-1985', '1990-1995', '2000-2005','2010-2015'),
labels = c('1950-1955','',  '',
'1980-1985',
'','','2010-2015')) +
theme_xygrid() +
scale_y_continuous(labels = scales::percent) +
ggtitle('Niger and Mali have high Total Fertility Rates relative to the rest of the region') +
theme(axis.text.x = element_text(size = 10),
panel.margin = unit(1, 'lines'))
library(llamar)
loadPkgs()
natl = read.csv('~/Documents/USAID/West Africa Regional 2016/dataout/WAFR_DHS_natl.csv')
df = natl %>%
filter(Indicator %in% c('Infant mortality rate', 'Under-five mortality rate (5 year periods)',
'Maternal mortality rate')) %>%
select(country = CountryName, year = SurveyYear, IndicatorId, Value) %>%
spread(IndicatorId, Value) %>%
rename(infant = CM_ECMR_C_IMR,
under5 = CM_ECMT_C_U5M,
maternal = MM_MMRT_W_MRT) %>%
group_by(country) %>%
mutate(yearNum = dense_rank(year))
order = df %>%
arrange(desc(infant))
order = unique(order$country)
df$country= factor(df$country, levels = order)
# infant, under 5 mort ----------------------------------------------------
y = ggplot(df, aes(x = infant, y = under5,
alpha = year, group = country)) +
geom_line(colour = 'dodgerblue') +
geom_point(size = 4, colour = 'white', alpha = 1) +
geom_point(size = 4, colour = 'dodgerblue') +
# scale_colour_gradientn(colours = brewer.pal(9, 'YlGnBu')) +
facet_wrap(~country) +
theme_xygrid()
# under 5, maternal mort --------------------------------------------------
ggplot(df, aes(x = maternal, y = under5,
alpha = year, group = country)) +
geom_line(colour = 'dodgerblue') +
geom_point(size = 4, colour = 'white', alpha = 1) +
geom_point(size = 4, colour = 'dodgerblue') +
# scale_colour_gradientn(colours = brewer.pal(9, 'YlGnBu')) +
facet_wrap(~country) +
theme_xygrid()
x = ggplot(df, aes(x = infant, y = under5,
alpha = year, group = country)) +
geom_line(colour = grey40K) +
geom_point(size = 4, colour = 'white', alpha = 1) +
geom_point(size = 4, colour = grey80K) +
theme_xygrid()
